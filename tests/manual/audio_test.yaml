name: audio_comprehensive_pipeline
description: "Pipeline kiểm tra toàn diện module Audio: Preprocess -> Diarize -> Transcribe"

# Cấu hình server MCP
servers:
  audio: src/xfmr_zem/servers/audio/server.py

# Định nghĩa luồng xử lý
pipeline:
  # Bước 1: Tiền xử lý âm thanh (Chuẩn hóa format)
  - name: step1_preprocess
    audio.preprocess:
      input:
        data:
          - audio_path: "tests/data/sample_audio.wav"
        audio_column: "audio_path"
        output_column: "prepared_audio"
    cache: false

  # Bước 2: Nhận diện người nói (Diarization)
  - name: step2_diarize
    audio.diarize:
      input:
        data: "$step1_preprocess"
        audio_column: "prepared_audio"
        speakers_column: "speaker_count"
        rttm_column: "rttm_file"
        output_dir: "./output/diarization"
    cache: false

  # Bước 3: Nhận diện giọng nói (ASR)
  - name: step3_transcribe
    audio.transcribe:
      input:
        data: "$step2_diarize"
        audio_column: "prepared_audio"
        text_column: "final_transcript"
        model: "zzasdf/viet_iter3_pseudo_label"
        batch_size: 1
    cache: false

  # Tùy chọn: Chạy Full Pipeline (Tất cả trong một)
  - name: end_to_end_test
    audio.full_pipeline:
      input:
        data:
          - audio_path: "tests/data/sample_audio.wav"
        audio_column: "audio_path"
        output_column: "result_json_path"
    cache: false

# Tham số cấu hình chi tiết
parameters:
  audio:
    asr:
      device: "cuda"
      decoding_method: "modified_beam_search"
    diarization:
      device: "cuda"
    preprocessing:
      enable_noise_reduction: true
      noise_reduction_strength: 0.5
