name: standard_data_processing_pipeline

# 1. Khai bÃ¡o cÃ¡c MCP servers Ä‘á»™c láº­p (Solid Architecture)
servers:
  nemo: ../../src/xfmr_zem/servers/nemo_curator/server.py
  dj: ../../src/xfmr_zem/servers/data_juicer/server.py
  instr: ../../src/xfmr_zem/servers/instruction_gen/server.py

# 2. Äá»‹nh nghÄ©a chuá»—i cÃ¡c bÆ°á»›c xá»­ lÃ½ (Technical-driven)
pipeline:
  # --- GIAI ÄOáº N 1: CLEANING (DataJuicer) ---
  - dj.clean_content:
      input:
        remove_html: true
        remove_emojis: true
        data:
          - text: "<html>Luáº­t sá»‘: 01/2020/NÄ-CP ğŸ˜Š</html>   vá» xá»­ pháº¡t hÃ nh chÃ­nh."
          - text: "VÄƒn báº£n trÃ¹ng láº·p..."
          - text: "VÄƒn báº£n trÃ¹ng láº·p..."

  # --- GIAI ÄOáº N 2: NORMALIZATION (NeMo Curator) ---
  - nemo.normalize:
      input:
        normalization: "NFC"
        cleanup_patterns:
          - ["\\x00|\\u200b|\\ufeff", ""] 
          - ["\\s+", " "]

  # --- GIAI ÄOáº N 3: TECHNICAL FILTERING (DataJuicer) ---
  - dj.refining_filter:
      input:
        min_len: 20
        alphanumeric_ratio: 0.2
  
  - dj.language_id:
      input:
        expected_lang: "vi"

  # --- GIAI ÄOáº N 4: DEDUPLICATION (NeMo Curator) ---
  - nemo.fuzzy_deduplication:
      input:
        threshold: 0.90
        algorithm: "levenshtein"

  # --- GIAI ÄOáº N 5: KNOWLEDGE EXTRACTION (InstructionGen) ---
  - instr.complexity_scorer:
      input:
        text_column: "text"

  - instr.generate_qa_pairs:
      input:
        base_url: "http://localhost:8000/v1"
        num_pairs: 3
        model: "vinallm-7b"
